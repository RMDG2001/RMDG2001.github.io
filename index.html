<!DOCTYPE html>
<html lang="es">
<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="IrisSkin - tatuajes temporales QR con la información de la persona, pensados para deportistas (corredores, ciclistas, nadadores) que necesitan seguridad sin peso ni incomodidad.">
        <title>IrisSkin — Tatuajes QR temporales para deportistas</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
        <style>
            /* Colores y tipografía */
            :root { --bg-beige: #f5efe6; --text-color: #000000; --accent: #8b5e3c; --accent-dark:#6f4b31; }
            body { background-color: var(--bg-beige); color: var(--text-color); }
            a, p, li, input, label { color: var(--text-color); }

            /* Botones/acento */
            .btn-primary {
                background-color: var(--accent) !important;
                border-color: var(--accent) !important;
                color: #fff !important;
            }
            .btn-primary:hover { background-color: var(--accent-dark) !important; border-color: var(--accent-dark) !important; }
            .btn-outline-secondary {
                color: var(--accent) !important; border-color: var(--accent) !important;
            }

            /* Tipografía para títulos (estilo 'griego' clásico) */
            h1,h2,h3,.card-title { font-family: 'Cinzel', Georgia, serif; color: var(--text-color); letter-spacing: 0.6px; }

            /* Encabezados: sin animaciones para mantener legibilidad */
            /* Los títulos conservan tipografía y estilo pero sin animaciones */
            h1,h2,h3,.card-title { font-family: 'Cinzel', Georgia, serif; color: var(--text-color); letter-spacing: 0.6px; }

            /* Secciones: animación de entrada/salida */
            .page-section { opacity: 0; transform: translateY(12px); transition: opacity .35s ease, transform .35s ease; }
            .page-section.visible { opacity: 1; transform: translateY(0); }
            .page-section.hidden { display: none; }

            /* Visual enhancements */
            .hero-card { background: rgba(255,255,255,0.6); border-radius:12px; padding:28px; box-shadow: 0 8px 24px rgba(0,0,0,0.08); }
            .feature-card { border-radius:10px; padding:18px; background: white; box-shadow: 0 6px 18px rgba(0,0,0,0.06); }
            .form-card { border-radius:10px; padding:18px; background: white; box-shadow: 0 6px 18px rgba(0,0,0,0.06); }
            .qr-frame { padding:12px; border-radius:8px; background: #fff; display:inline-block; box-shadow:0 6px 18px rgba(0,0,0,0.06); }
            /* Quiénes somos / Testimonios enhancements */
            .who-photo { width:100%; height:100%; object-fit:cover; border-radius:8px; }
            .who-card { background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.85)); padding:22px; border-radius:12px; box-shadow: 0 10px 28px rgba(0,0,0,0.06); }
            .testimonial-card { background: white; border-radius:10px; padding:14px; box-shadow: 0 6px 18px rgba(0,0,0,0.04); display:flex; gap:12px; align-items:flex-start; }
            .testimonial-avatar { width:64px; height:64px; object-fit:cover; border-radius:50%; box-shadow: 0 6px 16px rgba(0,0,0,0.08); }
            footer.site-footer { margin-top:36px; padding:20px 0; text-align:center; color: #4b3b2a; }
            .small-muted { color: #5a4b3a; }
        </style>
</head>
<body class="bg-light">
    <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom">
        <div class="container">
            <a class="navbar-brand" href="#">
                <img src="img/6c2ca04f-5fb4-40a2-ad66-cc4a6f180b08-removebg-preview.png" alt="IrisSkin" style="height:36px; object-fit:contain;">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link" href="#home">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#quienes">Quiénes somos</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#porque">Por qué nos eligen</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#testimonios">Testimonios</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#generar">Generar QR</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container py-5">
        <section id="home" class="page-section visible">
            <div class="row">
                <div class="col-12">
                    <div class="hero-card text-center">
                        <h1 class="mb-3">IrisSkin — Tatuajes QR temporales</h1>
                        <div class="d-flex justify-content-center mb-3">
                            <img src="img/6c2ca04f-5fb4-40a2-ad66-cc4a6f180b08-removebg-preview.png" alt="IrisSkin" class="img-fluid" style="max-height:180px; object-fit:contain;">
                        </div>
                        <p class="lead mb-3">Tatuajes temporales con QR que almacenan la información personal del deportista. Diseñados para corredores, ciclistas y nadadores de alto rendimiento: ligeros, discretos y resistentes al agua para no afectar el desempeño.</p>
                        <div class="d-flex justify-content-center">
                            <a href="#generar" class="btn btn-primary me-2">Generar QR</a>
                            <a href="#porque" class="btn btn-outline-secondary">¿Por qué IrisSkin?</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mt-4">
                <div class="col-md-4 mb-3">
                    <div class="feature-card text-center">
                        <h5>Ligereza</h5>
                        <p class="small-muted">Sin peso extra durante tus competencias.</p>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="feature-card text-center">
                        <h5>Resistente al agua</h5>
                        <p class="small-muted">Perfecto para natación y condiciones extremas.</p>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="feature-card text-center">
                        <h5>Información accesible</h5>
                        <p class="small-muted">Datos médicos y contactos de emergencia al alcance de un escaneo.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="quienes" class="page-section hidden">
            <div class="row align-items-center">
                <div class="col-md-6 mb-4 mb-md-0">
                    <div class="who-card overflow-hidden">
                        <img src="img/atltea.webp" alt="Atleta IrisSkin" class="who-photo">
                    </div>
                </div>
                <div class="col-md-6">
                    <h2>Quiénes somos</h2>
                    <p class="lead">IrisSkin surge del encuentro entre diseño, deporte y salud. Creamos tatuajes temporales con QR para que la información médica y de contacto esté siempre accesible sin añadir peso ni molestias al deportista.</p>
                    <div class="who-card mt-3">
                        <p>Somos un equipo multidisciplinario: diseñadores, médicos deportivos y deportistas que iteran sobre prototipos reales. Nuestro objetivo es que cada atleta pueda competir con tranquilidad sabiendo que su información vital está disponible con un simple escaneo.</p>
                        <ul class="small-muted">
                            <li><strong>Rápido:</strong> acceso inmediato vía QR.</li>
                            <li><strong>Discreto:</strong> diseño minimalista y ligero.</li>
                            <li><strong>Seguro:</strong> opciones para incluir contactos de emergencia y datos médicos.</li>
                        </ul>
                        <div class="mt-3">
                            <a href="#generar" class="btn btn-primary me-2">Crea tu primer QR</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="porque" class="page-section hidden">
            <div class="row">
                <div class="col-12">
                    <h2>Por qué nos eligen</h2>
                    <p class="lead">IrisSkin combina tecnología, ergonomía y seguridad para dar a los deportistas la tranquilidad de que su información esencial está disponible en cualquier momento, sin comprometer su rendimiento.</p>

                    <div class="row mt-3">
                        <div class="col-md-6">
                            <h5><i class="bi bi-shield-check me-2"></i>Seguridad inmediata</h5>
                            <p class="small-muted">En situaciones de emergencia el tiempo es crítico: un escaneo del QR muestra datos médicos, alergias, medicación y contactos de emergencia en una página clara y legible.</p>

                            <h5 class="mt-3"><i class="bi bi-card-heading me-2"></i>Privacidad controlada</h5>
                            <p class="small-muted">Tú decides qué información incorporar al QR. No almacenamos datos en servidores externos por defecto; los perfiles se generan como parámetros en la URL para facilitar hospedaje local o controlado.</p>
                        </div>

                        <div class="col-md-6">
                            <h5><i class="bi bi-speedometer2 me-2"></i>Diseño y confort</h5>
                            <p class="small-muted">Materiales y formas pensados para competir: tatuajes discretos, flexibles y ligeros que no limitan el movimiento ni aumentan rozamiento en la piel.</p>

                            <h5 class="mt-3"><i class="bi bi-droplet me-2"></i>Durabilidad en condiciones reales</h5>
                            <p class="small-muted">Probados en sudor, lluvia y largas distancias: la aplicación y el acabado aseguran que el QR siga legible durante la competencia, respetando al mismo tiempo la piel.</p>
                        </div>
                    </div>

                    <div class="mt-3 who-card">
                        <p class="mb-1"><strong>Aplicación práctica:</strong> nuestros kits incluyen instrucciones de aplicación rápida y consejos para ubicar el tatuaje donde sea más fácil de escanear (muñeca, antebrazo, parte superior del brazo).</p>
                        <p class="mb-0 small-muted">Si quieres, podemos ayudarte a generar plantillas a escala (en mm) para impresión, o un PDF listo para impresión y recorte.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="testimonios" class="page-section hidden">
            <div class="row">
                <div class="col-12">
                    <h2>Testimonios</h2>
                </div>
                <div class="col-md-6 mt-3">
                    <div class="testimonial-card">
                        <img src="https://picsum.photos/seed/user1/128/128" alt="María" class="testimonial-avatar">
                        <div>
                            <p class="mb-1">"Con IrisSkin pude correr con tranquilidad sabiendo que mi información estaba accesible sin tener que llevar nada extra."</p>
                            <small class="text-muted">María — Corredora de montaña</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 mt-3">
                    <div class="testimonial-card">
                        <img src="https://picsum.photos/seed/user2/128/128" alt="Javier" class="testimonial-avatar">
                        <div>
                            <p class="mb-1">"El tatuaje resistió todo el triatlón y los médicos pudieron ver mis datos al instante."</p>
                            <small class="text-muted">Javier — Triatleta</small>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="generar" class="page-section hidden">
            <div class="row">
                <div class="col-md-6">
                <h2 class="mb-3">Generar QR con datos de una persona</h2>
                <p class="small-muted">Abre el formulario para ingresar datos y generar el QR. El formulario ahora está en un modal para mantener la página limpia.</p>
                <div class="d-flex gap-2">
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#personModal">Abrir formulario</button>
                    <a class="btn btn-success" id="downloadBtn" style="display:none;" download="qr.jpg">Descargar JPG</a>
                    <button class="btn btn-success" id="downloadStickerBtn" style="display:none;">Descargar sticker</button>
                    <a class="btn btn-outline-secondary" id="openProfileBtn" style="display:none;" target="_blank">Abrir perfil</a>
                </div>
                <div class="mt-3">
                    <label class="form-label">Opciones de sticker</label>
                    <div class="d-flex gap-2 align-items-center flex-wrap">
                        <select id="stickerSizeSelect" class="form-select w-auto">
                            <option value="800px">800 px (web)</option>
                            <option value="1000px">1000 px (alta)</option>
                            <option value="30mm">30 mm @ 300 DPI</option>
                            <option value="40mm">40 mm @ 300 DPI</option>
                            <option value="50mm">50 mm @ 300 DPI</option>
                            <option value="60mm">60 mm @ 300 DPI</option>
                            <option value="custom">Personalizado (mm)</option>
                        </select>
                        <input id="customMM" type="number" class="form-control w-auto" style="max-width:120px; display:none;" placeholder="mm" min="5">
                        <label class="form-label mb-0 ms-2">DPI</label>
                        <input id="stickerDPI" type="number" class="form-control w-auto" style="max-width:100px;" value="300" min="72">
                        <button id="previewStickerBtn" class="btn btn-outline-secondary">Previsualizar sticker</button>
                        <label class="form-label mb-0 ms-2">Margen %</label>
                        <input id="stickerMargin" type="number" class="form-control w-auto" style="max-width:100px;" value="6" min="0" max="30"> 
                        <button id="downloadPdfBtn" class="btn btn-outline-primary" style="display:none;">Descargar PDF</button>
                    </div>
                    <div class="mt-3" id="stickerPreviewArea" style="display:none;">
                        <label class="form-label">Previsualización</label>
                        <div class="qr-frame d-inline-block">
                            <canvas id="stickerPreview" width="200" height="200"></canvas>
                        </div>
                        <div class="small text-muted d-block mt-2">La previsualización ajusta escala para visualización; la descarga tendrá la resolución seleccionada.</div>
                    </div>
                </div>
                <div class="mt-2 small text-muted">
                    Si quieres que el QR abra la página en tu teléfono, pega la URL base donde alojarás estos archivos (por ejemplo <code>http://192.168.1.10:8000/</code> o <code>https://mi-dominio.com/</code>) dentro del formulario.
                </div>
                            </div>

                            <div class="col-md-6">
                <h2 class="mb-3">Vista previa del QR</h2>
                <div class="card p-3">
                    <div class="d-flex justify-content-center mb-3">
                            <div class="qr-frame">
                                <canvas id="qrCanvas" width="300" height="300"></canvas>
                            </div>
                        </div>
                    <div id="progressArea" style="display:none;">
                        <label class="form-label">Generando QR...</label>
                        <div class="progress">
                            <div id="generationProgress" class="progress-bar" role="progressbar" style="width:0%" aria-valuemin="0" aria-valuemax="100">0%</div>
                        </div>
                    </div>
                </div>
                                <p class="mt-3 text-muted small">Escanea el QR con tu teléfono; te llevará a la página donde se muestra la información de la persona.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
            </div>
        </div>
    </div>

        <script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Modal con formulario (se abre desde 'Generar QR') -->
        <div class="modal fade" id="personModal" tabindex="-1" aria-labelledby="personModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="personModalLabel">Ingresar datos para el QR</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                    </div>
                    <div class="modal-body">
                        <form id="personForm">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="nombre" class="form-label">Nombre</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="bi bi-person"></i></span>
                                            <input type="text" class="form-control" id="nombre" placeholder="Juan" required>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="apellido" class="form-label">Apellido</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="bi bi-person-badge"></i></span>
                                            <input type="text" class="form-control" id="apellido" placeholder="Pérez">
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="email" class="form-label">Email</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="bi bi-envelope"></i></span>
                                            <input type="email" class="form-control" id="email" placeholder="email@ejemplo.com">
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="telefono" class="form-label">Teléfono</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="bi bi-telephone"></i></span>
                                            <input type="tel" class="form-control" id="telefono" placeholder="+593...">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="tiposangre" class="form-label">Tipo de Sangre</label>
                                        <input type="text" class="form-control" id="tiposangre" placeholder="O+, A-, B+, etc.">
                                    </div>
                                    <div class="mb-3">
                                        <label for="cedula" class="form-label">Cédula / ID</label>
                                        <input type="text" class="form-control" id="cedula" placeholder="1234567890">
                                    </div>
                                    <div class="mb-3">
                                        <label for="enfermedad" class="form-label">Enfermedad / Condición</label>
                                        <input type="text" class="form-control" id="enfermedad" placeholder="Ej: Asma, Diabetes, Alergia a ...">
                                    </div>
                                    <div class="mb-3">
                                        <label for="direccion" class="form-label">Dirección</label>
                                        <input type="text" class="form-control" id="direccion" placeholder="Calle, Ciudad">
                                    </div>
                                    <div class="mb-3">
                                        <label for="contactoEmergencia" class="form-label">Contacto de emergencia</label>
                                        <input type="text" class="form-control" id="contactoEmergencia" placeholder="Nombre - Teléfono">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Base URL (opcional)</label>
                                        <div class="input-group">
                                            <span class="input-group-text">Base URL</span>
                                            <input id="baseUrl" class="form-control" placeholder="Dejar vacío para ruta relativa">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex justify-content-end gap-2">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                                <button type="button" class="btn btn-primary" id="generateBtn">Generar QR</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    <footer class="site-footer">
        <div class="container">
            <small>© IrisSkin — Tatuajes QR temporales. Diseñado para deportistas. <span class="d-block">Contacto: info@irisskin.example</span></small>
        </div>
    </footer>
    <script>
        const form = document.getElementById('personForm');
        const qrCanvas = document.getElementById('qrCanvas');
        const downloadBtn = document.getElementById('downloadBtn');
        const openProfileBtn = document.getElementById('openProfileBtn');
        const progressArea = document.getElementById('progressArea');
        const generationProgress = document.getElementById('generationProgress');

        const qr = new QRious({
            element: document.getElementById('qrCanvas'),
            size: 300,
            value: ''
        });
        const baseUrlInput = document.getElementById('baseUrl');

        // Si la página se sirve vía HTTP(S), pre-llenar la base con el origen + path
        document.addEventListener('DOMContentLoaded', () => {
            try {
                if (location.protocol && location.protocol.startsWith('http')) {
                    const path = location.pathname.substring(0, location.pathname.lastIndexOf('/') + 1);
                    baseUrlInput.value = location.origin + path;
                }
            } catch (_) { /* ignore */ }
        });

        function buildQuery() {
            const params = new URLSearchParams();
            const fields = ['nombre','apellido','cedula','email','telefono','enfermedad','tiposangre','direccion','contactoEmergencia'];
            fields.forEach(id => {
                const el = document.getElementById(id);
                if (!el) return;
                const val = el.value.trim();
                if (val) params.set(id, val);
            });
            return params.toString();
        }

        // Construir la URL hacia profile.html incluyendo el parámetro embed=1
        function buildProfileUrl(includeEmbed = true) {
            const q = buildQuery();
            let base = (baseUrlInput && baseUrlInput.value) ? baseUrlInput.value.trim() : '';
            if (base && !base.endsWith('/')) base = base + '/';
            const profileBase = (base ? (base + 'profile.html') : 'profile.html');
            let suffix = '';
            if (q && includeEmbed) suffix = '?' + q + '&embed=1';
            else if (q) suffix = '?' + q;
            else if (includeEmbed) suffix = '?embed=1';
            return profileBase + suffix;
        }

        function simulateProgress(duration = 500) {
            return new Promise(resolve => {
                progressArea.style.display = 'block';
                generationProgress.style.width = '0%';
                generationProgress.textContent = '0%';
                const start = Date.now();
                const step = () => {
                    const elapsed = Date.now() - start;
                    let pct = Math.min(100, Math.floor((elapsed / duration) * 100));
                    generationProgress.style.width = pct + '%';
                    generationProgress.textContent = pct + '%';
                    if (pct < 100) requestAnimationFrame(step);
                    else setTimeout(() => { progressArea.style.display = 'none'; resolve(); }, 200);
                };
                requestAnimationFrame(step);
            });
        }

        document.getElementById('generateBtn').addEventListener('click', async function(){
            // Ahora construimos la URL usando buildProfileUrl para incluir embed=1
            const url = buildProfileUrl(true);

            await simulateProgress(600);

            // Actualizar el QR con la URL calculada
            qr.value = url;
            // Mostrar botones
            downloadBtn.style.display = 'inline-block';
            document.getElementById('downloadStickerBtn').style.display = 'inline-block';
            document.getElementById('downloadPdfBtn').style.display = 'inline-block';
            openProfileBtn.style.display = 'inline-block';

            try {
                const dataUrl = qrCanvas.toDataURL('image/jpeg', 0.92);
                downloadBtn.href = dataUrl;
            } catch (err) {
                console.error('No se pudo generar JPG:', err);
            }

            openProfileBtn.onclick = () => { window.open(url, '_blank'); };
        });

        // Generar una versión de alta resolución (sticker) y forzar la descarga
        async function generateStickerImage(url, size = 800, filename = 'sticker.jpg') {
            // Crear canvas temporal
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = size; tempCanvas.height = size;
            // Generar QR en canvas usando QRious
            new QRious({ element: tempCanvas, size: size, value: url, level: 'H' });

            // Opcional: añadir margen blanco para que sea un sticker recortable
            const border = Math.round(size * 0.06); // 6% del tamaño
            const outCanvas = document.createElement('canvas');
            outCanvas.width = size + border * 2; outCanvas.height = size + border * 2;
            const ctx = outCanvas.getContext('2d');
            // fondo blanco
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0,0,outCanvas.width,outCanvas.height);
            // dibujar el QR en el centro
            ctx.drawImage(tempCanvas, border, border, size, size);

            // convertir a dataURL y forzar descarga
            const dataUrl = outCanvas.toDataURL('image/jpeg', 0.95);
            const a = document.createElement('a');
            a.href = dataUrl;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            a.remove();
        }

        function computeStickerPixels() {
            const sel = document.getElementById('stickerSizeSelect').value;
            const dpi = parseInt(document.getElementById('stickerDPI').value, 10) || 300;
            if (sel.endsWith('px')) return parseInt(sel.replace('px',''), 10);
            if (sel.endsWith('mm')) {
                const mm = parseFloat(sel.replace('mm','')) || 40;
                return Math.round(mm * dpi / 25.4);
            }
            if (sel === 'custom') {
                const mm = parseFloat(document.getElementById('customMM').value) || 40;
                return Math.round(mm * dpi / 25.4);
            }
            return 800;
        }

        document.getElementById('previewStickerBtn').addEventListener('click', async function(){
            const url = buildProfileUrl(true);
            const pixels = computeStickerPixels();
            // render small preview scaled to fit preview canvas
            const previewCanvas = document.getElementById('stickerPreview');
            const area = document.getElementById('stickerPreviewArea');
            const maxPreview = 300; // max preview px
            const scale = Math.min(maxPreview / pixels, 1);
            const displaySize = Math.max(100, Math.round(pixels * scale));
            previewCanvas.width = displaySize; previewCanvas.height = displaySize;
            // use temporary QRious to draw into preview
            new QRious({ element: previewCanvas, size: displaySize, value: url, level: 'H' });
            area.style.display = 'block';
        });

        // Mostrar input mm cuando el usuario selecciona 'custom'
        document.getElementById('stickerSizeSelect').addEventListener('change', function(){
            const val = this.value;
            const custom = document.getElementById('customMM');
            if (val === 'custom') { custom.style.display = 'inline-block'; }
            else { custom.style.display = 'none'; }
        });

        document.getElementById('downloadStickerBtn').addEventListener('click', async function(){
            const url = buildProfileUrl(true);
            const pixels = computeStickerPixels();
            // determine filename
            const sel = document.getElementById('stickerSizeSelect').value;
            let fname = 'irisskin-sticker-' + pixels + 'px.jpg';
            if (sel.endsWith('mm') || sel === 'custom') {
                const mm = (sel === 'custom') ? (document.getElementById('customMM').value || 'mm') : sel.replace('mm','');
                fname = `irisskin-sticker-${mm}mm-${document.getElementById('stickerDPI').value || 300}dpi.jpg`;
            }
            await generateStickerImage(url, pixels, fname);
        });

        // Helper to compute physical mm size for current selection
        function computeStickerMM() {
            const sel = document.getElementById('stickerSizeSelect').value;
            const dpi = parseInt(document.getElementById('stickerDPI').value, 10) || 300;
            if (sel.endsWith('mm')) return parseFloat(sel.replace('mm',''));
            if (sel === 'custom') return parseFloat(document.getElementById('customMM').value) || 40;
            // sel ends with px
            const px = parseInt(sel.replace('px',''), 10) || 800;
            return (px * 25.4) / dpi; // mm
        }

        // Generar PDF con tamaño físico exacto (mm)
        async function generateStickerPDF(url, mmSize, dpi = 300, marginPercent = 6, filename = 'sticker.pdf') {
            const pixels = Math.round(mmSize * dpi / 25.4);
            // create QR canvas at pixels
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = pixels; tempCanvas.height = pixels;
            new QRious({ element: tempCanvas, size: pixels, value: url, level: 'H' });

            // add white margin in pixels
            const marginPx = Math.round(pixels * (marginPercent/100));
            const outCanvas = document.createElement('canvas');
            outCanvas.width = pixels + marginPx*2; outCanvas.height = pixels + marginPx*2;
            const ctx = outCanvas.getContext('2d');
            ctx.fillStyle = '#ffffff'; ctx.fillRect(0,0,outCanvas.width,outCanvas.height);
            ctx.drawImage(tempCanvas, marginPx, marginPx, pixels, pixels);

            const imgData = outCanvas.toDataURL('image/jpeg', 0.95);
            const { jsPDF } = window.jspdf;
            // create pdf page sized to (mmSize + 2*marginMM) in mm
            const marginMM = (mmSize * marginPercent/100);
            const pageW = mmSize + marginMM*2; const pageH = pageW; // square
            const pdf = new jsPDF({ unit: 'mm', format: [pageW, pageH] });
            // place image at marginMM, width = mmSize
            pdf.addImage(imgData, 'JPEG', marginMM, marginMM, mmSize, mmSize);
            pdf.save(filename);
        }

        document.getElementById('downloadPdfBtn').addEventListener('click', async function(){
            const url = buildProfileUrl(true);
            const mm = computeStickerMM();
            const dpi = parseInt(document.getElementById('stickerDPI').value, 10) || 300;
            const margin = parseFloat(document.getElementById('stickerMargin').value) || 6;
            const sel = document.getElementById('stickerSizeSelect').value;
            let fname = `irisskin-sticker-${Math.round(mm)}mm-${dpi}dpi.pdf`;
            await generateStickerPDF(url, mm, dpi, margin, fname);
        });

        // Navegación entre 'páginas' internas (mostrar/ocultar secciones) CON ANIMACIÓN
        const navLinks = document.querySelectorAll('.navbar .nav-link');
        const sections = document.querySelectorAll('.page-section');

        function showSection(id) {
            const current = document.querySelector('.page-section.visible');
            const target = document.getElementById(id);

            if (current && current !== target) {
                // quitar visible para iniciar transición de salida
                current.classList.remove('visible');
                // cuando termine la transición, ocultar por completo
                const onEnd = (e) => {
                    if (e.target === current) {
                        current.classList.add('hidden');
                        current.removeEventListener('transitionend', onEnd);
                    }
                };
                current.addEventListener('transitionend', onEnd);
            }

            if (target && current !== target) {
                // mostrar objetivo antes de añadir la clase visible
                target.classList.remove('hidden');
                // forzar reflow para que la transición tenga efecto
                void target.offsetWidth;
                target.classList.add('visible');
            }

            // actualizar estado activo en la navbar
            navLinks.forEach(a => {
                try {
                    const targetName = (a.getAttribute('href') || '').replace('#','');
                    if (targetName === id) a.classList.add('active'); else a.classList.remove('active');
                } catch (_) {}
            });
        }

        navLinks.forEach(a => {
            a.addEventListener('click', function(e){
                e.preventDefault();
                const target = (this.getAttribute('href') || '').replace('#','');
                if (target) {
                    showSection(target);
                    history.replaceState(null, '', '#' + target);
                }
            });
        });

        // Asegurar que otros enlaces internos (CTA fuera de la navbar) también abran las secciones correctamente
        document.querySelectorAll('a[href^="#"]').forEach(a => {
            if (a.classList.contains('nav-link')) return; // ya manejados
            a.addEventListener('click', function(e){
                e.preventDefault();
                const target = (this.getAttribute('href') || '').replace('#','');
                if (target) {
                    showSection(target);
                    history.replaceState(null, '', '#' + target);
                }
            });
        });

        // Mostrar sección inicial: si hay hash en URL, abrir esa sección; sino 'home'
        const initial = (location.hash && location.hash.length>1) ? location.hash.substring(1) : 'home';
        setTimeout(() => showSection(initial), 50);

            // Se removieron las animaciones por letra en títulos para mejor legibilidad.

        /* Micro-animations: botones con transición y efecto ripple */
        (function addButtonMicroAnimations(){
            const style = document.createElement('style');
            style.textContent = `
            .btn { transition: transform .08s ease, box-shadow .12s ease; position: relative; overflow: hidden; }
            .btn:active { transform: scale(.985); }
            .ripple { position: absolute; border-radius: 50%; transform: scale(0); background: rgba(255,255,255,0.45); animation: ripple .6s linear; pointer-events: none; }
            @keyframes ripple { to { transform: scale(4); opacity: 0; } }
            `;
            document.head.appendChild(style);

            document.addEventListener('click', function (e) {
                const btn = e.target.closest('.btn');
                if (!btn) return;
                const rect = btn.getBoundingClientRect();
                const ripple = document.createElement('span');
                ripple.className = 'ripple';
                const size = Math.max(rect.width, rect.height) * 1.2;
                ripple.style.width = ripple.style.height = size + 'px';
                ripple.style.left = (e.clientX - rect.left - size/2) + 'px';
                ripple.style.top = (e.clientY - rect.top - size/2) + 'px';
                btn.appendChild(ripple);
                setTimeout(() => ripple.remove(), 700);
            }, {passive: true});
        })();
    </script>
</body>
</html>